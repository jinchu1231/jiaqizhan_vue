(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-094005da"],{"19ac":function(t,e,i){"use strict";i.d(e,"i",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"g",(function(){return a})),i.d(e,"h",(function(){return r})),i.d(e,"d",(function(){return c})),i.d(e,"e",(function(){return l})),i.d(e,"f",(function(){return d})),i.d(e,"a",(function(){return u})),i.d(e,"b",(function(){return g}));var o=i("b775");function s(t){return Object(o["a"])({url:"/api/oauth/Login/socials",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t})}function n(){return Object(o["a"])({url:"/api/oauth/getLoginConfig",method:"get"})}function a(){return Object(o["a"])({url:"/api/oauth/getTicket",method:"get"})}function r(t){return Object(o["a"])({url:"/api/oauth/getTicketStatus/".concat(t),method:"get"})}function c(t){return Object(o["a"])({url:"/api/permission/socials/login",method:"GET",data:t})}function l(){return Object(o["a"])({url:"/api/permission/socials",method:"GET"})}function d(t){return Object(o["a"])({url:"/api/permission/socials?userId="+t,method:"GET"})}function u(t){return Object(o["a"])({url:"/api/permission/socials/render/".concat(t),method:"GET"})}function g(t,e){return Object(o["a"])({url:"/api/permission/socials/".concat(e,"?userId=").concat(t),method:"DELETE"})}},"395d":function(t,e,i){t.exports=i.p+"static/img/login-company-logo.d15ea866.png"},5834:function(t,e,i){},"64bb":function(t,e,i){t.exports=i.p+"static/img/login_logo.1efa7241.png"},"7e1d":function(t,e,i){t.exports=i.p+"static/img/login_qr.adf7e57a.png"},"9ed6":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"login-container"},[t.sysConfig&&t.sysConfig.sysVersion?o("div",{staticClass:"login-version"},[o("p",{staticClass:"login-version-text"},[t._v(t._s(t.sysConfig.sysVersion))])]):t._e(),o("div",{staticClass:"login-left"},[t._m(0),o("img",{staticClass:"login-banner",attrs:{src:i("bdec"),alt:""}}),t.showTxt?o("div",{staticClass:"login-left-txt"},[o("p",{staticClass:"title1"},[t._v("赋能开发者，提速企业数字化，零代码实现80%的基础功能")]),t._m(1),o("a",{staticClass:"link",attrs:{target:"_blank",href:"https://www.jnpfsoft.com"}},[t._v("了解更多")])]):t._e()]),o("div",{staticClass:"login-content"},[o("div",{staticClass:"login-form"},[t.sysConfig&&t.sysConfig.loginIcon?o("el-image",{staticClass:"login-logo",attrs:{src:t.define.comUrl+t.sysConfig.loginIcon}},[o("template",{slot:"error"},[o("img",{staticClass:"login-logo",attrs:{src:i("64bb"),alt:""}})])],2):o("img",{staticClass:"login-logo",attrs:{src:i("64bb"),alt:""}}),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.isSso&&!t.ssoLoading,expression:"!isSso && !ssoLoading"}]},[o("div",{staticClass:"login-tab",class:"active"+t.active},[o("a",{staticClass:"item",class:{active:1==t.active},on:{click:function(e){t.active=1}}},[t._v(t._s(t.$t("login.title")))]),o("a",{staticClass:"item",class:{active:2==t.active},on:{click:function(e){t.active=2}}},[t._v(t._s(t.$t("login.scanTitle")))])]),o("el-form",{directives:[{name:"show",rawName:"v-show",value:1==t.active,expression:"active==1"}],ref:"loginForm",attrs:{model:t.loginForm,rules:t.loginRules,autocomplete:"on","label-position":"left"}},[o("el-form-item",{attrs:{prop:"account"}},[o("el-input",{ref:"account",attrs:{placeholder:t.$t("login.username"),name:"account",type:"text",tabindex:"1",autocomplete:"on","prefix-icon":"el-icon-user",size:"large"},on:{change:t.getConfig},model:{value:t.loginForm.account,callback:function(e){t.$set(t.loginForm,"account",e)},expression:"loginForm.account"}})],1),o("el-tooltip",{attrs:{content:t.$t("login.upper"),placement:"right",manual:""},model:{value:t.capsTooltip,callback:function(e){t.capsTooltip=e},expression:"capsTooltip"}},[o("el-form-item",{attrs:{prop:"password"}},[o("el-input",{ref:"password",attrs:{"show-password":"",placeholder:t.$t("login.password"),name:"password",tabindex:"2",autocomplete:"on","prefix-icon":"el-icon-lock",size:"large"},on:{blur:function(e){t.capsTooltip=!1}},nativeOn:{keyup:function(e){return t.checkCapslock(e)}},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1)],1),t.needCode?o("el-form-item",{attrs:{prop:"code"}},[o("el-row",{attrs:{type:"flex",justify:"space-between"}},[o("el-col",{staticClass:"sms-input"},[o("el-input",{attrs:{placeholder:t.$t("login.codeTip"),name:"code",autocomplete:"on","prefix-icon":"el-icon-key",size:"large"},model:{value:t.loginForm.code,callback:function(e){t.$set(t.loginForm,"code",e)},expression:"loginForm.code"}})],1),o("el-col",{staticClass:"sms-right code-right"},[o("el-tooltip",{attrs:{content:t.$t("login.changeCode"),placement:"bottom"}},[o("img",{attrs:{id:"imgcode",alt:t.$t("login.changeCode"),src:t.define.comUrl+t.imgUrl},on:{click:t.changeImg}})])],1)],1)],1):t._e(),o("el-button",{staticClass:"login-btn",attrs:{loading:t.loading,type:"primary",size:"large"},nativeOn:{click:function(e){return e.preventDefault(),t.handleLogin(e)}}},[t._v(t._s(t.$t("login.logIn")))]),t.socialsList.length?[o("el-divider",{staticClass:"divider__text",attrs:{"content-position":"center"}},[t._v("其他登录方式")]),o("div",{staticClass:"other-list"},t._l(t.socialsList,(function(e,i){return o("div",{key:i},[o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.name+"登录",placement:"top"}},[o("div",{staticClass:"other-item",on:{click:function(i){return t.otherLogin(e.enname)}}},[o("i",{class:e.icon})])])],1)})),0)]:t._e()],2),o("div",{directives:[{name:"show",rawName:"v-show",value:2==t.active,expression:"active==2"}],staticClass:"login-form-QRCode"},[o("img",{staticClass:"qrcode-img",attrs:{src:i("7e1d")}}),o("p",{staticClass:"qrcode-tip"},[t._v("正在测试,稍后上线")])])],1),o("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isSso&&!t.ssoLoading,expression:"isSso && !ssoLoading"}],staticClass:"sso-login-btn",attrs:{type:"primary",size:"large",loading:t.loading},nativeOn:{click:function(e){return e.preventDefault(),t.ssoLogin(e)}}},[t._v("登录")])],1),o("div",{staticClass:"copyright"},[t._v(" "+t._s(t.sysConfig.copyright))])]),o("el-dialog",{staticClass:"JNPF-dialog JNPF-dialog_center JNPF-dialog-sso",attrs:{title:"登录","close-on-click-modal":!1,visible:t.visible,"close-on-press-escape":!1,"lock-scroll":"",width:"1000px"},on:{"update:visible":function(e){t.visible=e},open:t.onOpen}},[t.show?o("iframe",{attrs:{width:"100%",height:"100%",src:t.ssoUrl,frameborder:"0"}}):t._e()]),o("el-dialog",{staticClass:"JNPF-dialog JNPF-dialog_center form-script-dialog other-login-dialog",attrs:{visible:t.dialogVisible,width:"600px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[o("div",{staticClass:"other-main"},[o("div",{staticClass:"other-title"},[o("div",{staticClass:"other-icon"},[o("i",{staticClass:"icon-ym icon-ym-user"})]),o("div",{staticClass:"other-text"},[t._v("请选择登录账号")])]),o("div",{staticClass:"other-body"},[o("el-row",{attrs:{gutter:20}},[t._l(t.tenantSocialList,(function(e,i){return[o("el-col",{key:i,attrs:{span:12}},[o("div",{on:{click:function(i){return t.socailsLogin(e)}}},[o("el-card",{staticClass:"other-login-card",attrs:{shadow:"hover"}},[o("h2",[t._v(t._s(e.socialName))]),o("div",{staticClass:"other-login-des"},[t._v("租户名称："+t._s(e.tenantName))]),o("div",{staticClass:"other-login-des"},[t._v("租户ID："+t._s(e.tenantId))]),o("div",{staticClass:"other-login-des"},[t._v("账号ID："+t._s(e.accountName))])])],1)])]}))],2)],1)])])],1)},s=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("a",{staticClass:"login-company-logo",attrs:{target:"_blank",href:"https://www.jnpfsoft.com"}},[o("img",{staticClass:"login-company-logo-img",attrs:{src:i("395d"),alt:""}})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"title2"},[t._v("已帮助"),i("span",[t._v("20000+")]),t._v("家企业完成数字化转型升级")])}],n=(i("a481"),i("ac6a"),i("456d"),i("5530")),a=i("c24f"),r=i("19ac"),c=i("4328"),l=i.n(c),d={name:"Login",data:function(){return{loginForm:{account:"",password:"",code:"",origin:"password"},loginRules:{account:[{required:!0,trigger:"blur",message:this.$t("login.accountTip")}],password:[{required:!0,trigger:"blur",message:this.$t("login.passwordTip")}],code:[{required:!0,trigger:"blur",message:this.$t("login.codeTip")}]},imgUrl:"",timestamp:"",capsTooltip:!1,loading:!1,showDialog:!1,needCode:!1,codeLength:4,redirect:void 0,showTxt:!1,otherQuery:{},active:1,listenerLoad:!1,visible:!1,show:!1,ssoLoading:!0,isSso:!1,preUrl:"",ssoUrl:"",ssoTicket:"",ticketParams:"",ssoTimer:null,socialsList:[],dialogVisible:!1,tenantSocialList:[],redirectUrl:""}},computed:{sysConfig:function(){return this.$store.state.settings.sysConfig},loginLoading:function(){return this.$store.state.user.loginLoading}},watch:{loginLoading:function(t){t||(this.loading=!1)},visible:function(t){t||(this.loading=!1,this.show=!1,this.clearTimer())},$route:{handler:function(t){var e=t.query;e&&(this.redirect=e.redirect,this.otherQuery=this.getOtherQuery(e))},immediate:!0}},created:function(){var t=this;document.onkeydown=function(e){var i=e.keyCode;13===i&&t.handleLogin()},this.needCode&&this.changeImg(),this.getLoginConfig()},mounted:function(){var t=this;this.$store.commit("user/SET_LOGIN_LOADING",!1),this.setShowTxt(),window.onresize=function(){t.setShowTxt()}},destroyed:function(){document.onkeydown=function(t){t.keyCode}},methods:{setShowTxt:function(){document.documentElement.clientHeight<=840?this.showTxt=!1:this.showTxt=!0},checkCapslock:function(t){var e=t.key;this.capsTooltip=e&&1===e.length&&e>="A"&&e<="Z"},getConfig:function(t){var e=this;t&&Object(a["a"])(this.loginForm.account).then((function(t){e.needCode=!!t.data.enableVerificationCode,e.needCode&&(e.codeLength=t.data.verificationCodeNumber||4,e.changeImg())}))},handleLogin:function(){var t=this;this.loading||this.$refs.loginForm.validate((function(e){if(!e)return!1;t.loading=!0,t.$store.commit("user/SET_LOGIN_LOADING",!0);var i=Object(n["a"])(Object(n["a"])({},t.loginForm),{},{timestamp:t.timestamp,jnpf_ticket:t.ssoTicket});t.$store.dispatch("user/login",i).then((function(e){t.$router.push({path:t.redirect||"/home",query:t.otherQuery})})).catch((function(){t.needCode&&(t.changeImg(),t.loginForm.code=""),t.$store.commit("user/SET_LOGIN_LOADING",!1)}))}))},changeImg:function(){var t=Math.random();this.timestamp=t,this.imgUrl="/api/oauth/ImageCode/".concat(this.codeLength||4,"/").concat(t)},getOtherQuery:function(t){return Object.keys(t).reduce((function(e,i){return"redirect"!==i&&(e[i]=t[i]),e}),{})},otherLoginList:function(){var t=this;this.socialsList=[],Object(r["d"])().then((function(e){t.socialsList=e.data.filter((function(t){return"true"==t.isLatest}))}))},otherLogin:function(t){var e=this;Object(r["g"])().then((function(i){if(e.ssoTicket=i.data,e.winURL&&!e.winURL.closed)return e.winURL.location.replace(e.redirectUrl),void e.winURL.focus();e.socialsList.forEach((function(i){if(t==i.enname){var o=i.renderUrl.replace("JNPF_TICKET",e.ssoTicket);e.redirectUrl=o}}));var o=750,s=500,n=(window.screen.width-o)/2,a=(window.screen.height-s)/2;e.winURL=window.open(e.redirectUrl,"_blank","height="+s+",innerHeight="+s+",width="+o+",innerWidth="+o+",top="+a+",left="+n+",toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no"),e.ssoTimer=setInterval((function(){e.winURL.closed&&e.clearTimer(),e.getTicketStatus()}),1e3)}))},getTicketStatus:function(){var t=this;this.ssoTicket&&Object(r["h"])(this.ssoTicket).then((function(e){if(2!=e.data.status)switch(t.winURL&&t.winURL.close(),4==e.data.status?(clearInterval(t.ssoTimer),t.ssoTimer=null):t.clearTimer(),e.data.status){case 1:var i={theme:e.data.theme,token:e.data.value};t.$store.dispatch("user/setToken",i).then((function(e){t.$router.push({path:t.redirect||"/home",query:t.otherQuery})}));break;case 4:t.$message.error("第三方账号未绑定，5分钟内登录本系统账号密码自动绑定该账号！"),t.visible=!1,t.ssoUrl="";break;case 6:t.dialogVisible=!0,t.tenantSocialList="string"===typeof e.data.value?JSON.parse(e.data.value):e.data.value;break;default:t.$message.error(e.data.value||"账号异常！"),t.visible=!1,t.ssoUrl="",t.getLoginConfig();break}}))},clearTimer:function(){this.ssoTimer&&(clearInterval(this.ssoTimer),this.ssoTimer=null,this.ssoTicket="")},handleClose:function(){this.dialogVisible=!1},socailsLogin:function(t){var e=this;Object(r["i"])(l.a.stringify(Object(n["a"])(Object(n["a"])({},t),{},{tenantLogin:!0}))).then((function(t){200==t.code&&e.$store.dispatch("user/setToken",t.data).then((function(t){e.$router.push({path:e.redirect||"/home",query:e.otherQuery})}))}))},ssoLogin:function(){var t=this;this.loading||(this.loading=!0,Object(r["g"])().then((function(e){t.ssoTicket=e.data,t.ssoUrl=t.preUrl+"?"+t.ticketParams+"="+t.ssoTicket,t.visible=!0,t.ssoTimer=setInterval((function(){t.getTicketStatus()}),1e3)})))},getLoginConfig:function(){var t=this;Object(r["c"])().then((function(e){t.isSso=e.data.redirect,t.preUrl=e.data.url,t.ticketParams=e.data.ticketParams,t.socialsList=e.data.socialsList||[],localStorage.setItem("useSocials",t.socialsList.length),t.ssoLoading=!1})).catch((function(){t.isSso=!1,t.ssoLoading=!1}))},onOpen:function(){this.show=!0}}},u=d,g=(i("e6ac"),i("2877")),h=Object(g["a"])(u,o,s,!1,null,"0b69b306",null);e["default"]=h.exports},bdec:function(t,e,i){t.exports=i.p+"static/img/login-banner.c755f78d.png"},e6ac:function(t,e,i){"use strict";i("5834")}}]);